# 设置ZIP包解压规则

对象存储OSS提供ZIP文件自动解压功能。配置解压规则后，您上传到OSS指定路径的ZIP文件都会被自动解压。

已开通函数计算服务。您可以在函数计算的[产品详情](https://www.alibabacloud.com/zh/product/function-compute?spm=a2796.7919406.3156523820.144.5fd33c37asF0wx)页面开通函数计算服务。

ZIP包解压结合函数计算完成ZIP文件的解压工作，解压流程如下图所示。

![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9025896061/p38103.png)

匹配解压规则的ZIP文件在上传到OSS后，会自动触发函数计算进行解压。文件解压完成后，会存储至OSS的指定目录中。

## 注意事项

使用ZIP包解压功能时需注意以下事项：

-   除华南2（河源）、华南3（广州）、华北6（乌兰察布）、阿联酋（迪拜）外，其他地域均已支持ZIP包解压。
-   建议使用UTF-8或GB 2312编码命名您的文件或文件夹，否则可能会出现解压后的文件或文件夹名称出现乱码、解压过程中断等问题。
-   归档或冷归档类型的文件需先解冻再解压。
-   解压单个压缩包的最大时间是10分钟，超过10分钟未完成的任务会解压失败。
-   ZIP包解压功能是增值服务，函数计算会根据解压执行时间计算费用。更多信息，请参见[计费方式](https://www.alibabacloud.com/help/zh/doc-detail/54301.htm)。

## 配置ZIP包解压规则

1.  登录[OSS管理控制台](https://oss.console.aliyun.com/)。

2.  单击**Bucket列表**，然后单击目标Bucket名称。

3.  单击**数据处理** \> **ZIP包解压**。

4.  单击**ZIP包解压**，然后在ZIP包解压面板配置ZIP包解压规则。

    -   参数说明

        |参数|是否必选|说明|
        |--|----|--|
        |**服务授权**|是|授予函数计算读写OSS和执行函数的权限。单击**授权**按钮，之后按照提示完成授权。 |
        |**触发器授权**|是|授予OSS访问函数计算的权限。单击**授权**按钮，之后按照提示完成授权。若已完成授权，此项显示为**触发器角色**。 |
        |**前缀**|否|配置触发函数计算的文件前缀。您上传指定前缀的ZIP文件或将ZIP文件上传至指定目录会触发函数计算。置空此项则匹配所有上传的ZIP文件。**说明：** 置空此项可能会触发循环执行，建议您配置文件前缀。更多信息，请参见[如何避免循环执行](https://www.alibabacloud.com/help/zh/doc-detail/181819.htm)。 |
        |**目标目录**|否|填写ZIP文件解压后存放的目录。置空此项，函数计算会将ZIP文件解压到当前Bucket的根目录。若您需要在目标目录中保留ZIP文件名，则选中**保留压缩文件名为路径目录**；若您不需要保留ZIP文件名，直接将解压后的文件存放在目标目录，则选中**直接解压到目标目录中**。配置详情请参见以下配置示例。|

    -   配置示例

        |场景|配置方法|解压后的文件结构|
        |--|----|--------|
        |所有上传至zipfolder目录的ZIP包均解压到destfolder目录，不保留ZIP包名称。|        -   **前缀**设置为zipfolder/。
        -   **目标目录**设置为destfolder。
        -   选中**直接解压到目标目录中**。
|        ```
bucket  
├─── zipfolder/   
│    ├─── a.zip
│    └─── b.zip
└─── destfolder/
     ├─── a.txt
     ├─── b.txt
     └─── ...
        ``` |
        |所有上传至zipfolder目录的ZIP包均解压到根目录，保留ZIP包名称。|您需要配置如下参数：        -   **前缀**设置为zipfolder/。
        -   **目标目录**设置为空。
        -   选中**保留压缩文件名为路径目录**。
|        ```
bucket  
├─── zipfolder/   
│    ├─── a.zip
│    └─── b.zip
├─── a/
│    ├─── a.txt
│    └─── ...
└─── b/
     ├─── b.txt
     └─── ...
        ``` |
        |所有上传至zipfolder目录的ZIP包均解压到destfolder目录，保留ZIP包名称。|您需要配置如下参数：        -   **前缀**设置为zipfolder/。
        -   **目标目录**设置为destfolder。
        -   选中**保留压缩文件名为路径目录**。
|        ```
bucket  
├─── zipfolder/   
│    ├─── a.zip
│    └─── b.zip
└─── destfolder/
     ├─── a/
     │    ├─── a.txt
     │    └─── ...
     └─── b/
          ├─── b.txt
          └─── ...
        ``` |

5.  选中**我已知晓并同意开通函数计算，通过函数计算处理压缩文件。压缩文件里面的文件名或文件夹名不支持非UTF-8或GB 2312编码**后，单击**确定**。


## 修改ZIP包解压配置

您可以根据自己的需求随时修改ZIP包解压的配置。

-   修改前缀
    1.  进入ZIP包解压页签。
    2.  单击目标触发器右侧的**编辑**跳转到函数计算控制台。
    3.  在弹出的**修改触发器**面板修改**触发规则**区域的**前缀**，其他参数建议保持默认。
    4.  单击**确定**。
-   修改函数计算配置
    1.  进入ZIP包解压页签。
    2.  单击目标触发器右侧的**编辑**跳转到函数计算控制台。
    3.  在弹出的**修改触发器**面板单击**取消**。
    4.  单击**概览**页签，之后单击**修改配置**。
    5.  在弹出的**配置函数**页面修改函数配置。

        您可以根据实际需求修改**函数执行内存**、**超时时间**、**环境变量**：

        -   **函数执行内存**：根据您处理的文件大小来选择，若您的ZIP文件较小，可以选择更小规格的函数执行内存来节省费用。
        -   **超时时间**：函数在规定时间内未能执行，函数计算会返回超时错误。建议配置合适的超时时间，避免函数执行超时。
        -   **环境变量**：修改此项的值会修改解压文件的目标目录。
    6.  单击**提交**。

## 删除ZIP包解压规则

对于不需要的ZIP包解压规则，您可以手动删除。

1.  进入ZIP包解压页签。

2.  单击目标触发器右侧的**编辑**跳转到函数计算控制台。

3.  在弹出的**修改触发器**面板单击**取消**。

4.  单击触发器页签，之后单击目标触发器右侧的**删除**。

5.  在弹出的对话框单击**确定**。


