# 设置定时备份

您可以使用OSS的定时备份功能将存储空间（Bucket）内的文件（Object）定期备份到混合云备份服务HBR中，当您的Object意外丢失时，可通过HBR进行恢复。

-   已开通HBR。您可以在[混合云备份产品页](https://www.aliyun.com/product/hbr)开通此功能。
-   已授权HBR读取OSS数据。在[混合云备份管理控制台](https://hbr.console.aliyun.com)单击**OSS备份**，之后按步骤完成授权。

## 费用说明

使用定时备份时，会产生如下费用：

-   OSS的请求费用

    -   每次备份任务开始前，HBR会使用ListObject接口获取Object列表。每1000个Object产生1次API请求。
    -   获取Object列表后，HBR会通过HeadObject接口获取目标文件的元信息。每个Object产生1次API请求。
    -   备份文件时，HBR会通过GetObject接口备份文件。每个Object产生1次API请求。
    -   备份文件时，HBR会通过ListObject接口获取备份进度并校验文件，每1000个Object产生1次API请求。
    OSS API请求的计费方式，请参见[请求费用](/cn.zh-CN/计量计费/计量项和计费项/请求费用.md)。

-   备份低频访问类型文件时会产生低频访问数据取回费用。计费方式，请参见[低频访问数据取回费用](/cn.zh-CN/计量计费/计量项和计费项/数据处理费用.md)。
-   存储备份文件会产生HBR备份库存储容量费用。计费方式，请参见[计费方式与计费项](/cn.zh-CN/计量计费/计费方式与计费项.md)。

    当前使用定时备份的默认配置时，前两个月不产生备份库存储容量费用。


## 使用限制

-   不支持为归档和冷归档存储类型的Bucket配置定时备份。
-   不支持备份和恢复软链接（Symlink）、归档和冷归档存储类型的Object以及Object的读写权限ACL。
-   仅华东1（杭州）、华东2（上海）、华南1（深圳）、华北2（北京）、华北3（张家口）、中国（香港）、新加坡、澳大利亚（悉尼）、印度尼西亚（雅加达）、美国（硅谷）地域支持定时备份功能。

## 方式一：为已创建的Bucket设置定时备份

1.  登录[OSS管理控制台](https://oss.console.aliyun.com/)。

2.  在左侧导航栏，单击**Bucket列表**，之后单击目标Bucket。

3.  在左侧导航栏，选择**文件管理** \> **定时备份**。

4.  单击**备份Bucket**。

5.  配置备份计划。

    -   配置免费备份计划

        HBR为OSS的定时备份提供2个月的免费试用期，试用期内不会产生HBR的相关费用。若您希望免费试用定时备份功能，请在创建备份计划面板配置以下参数：

        |参数|说明|
        |--|--|
        |**备份OSS Bucket**|显示当前Bucket名称。|
        |**备份计划名称**|设置备份计划名称，长度不得超过64个字符。可不填，HBR会根据当前时间生成备份计划名称。 |
        |**备份起始时间**|选择备份开始执行的时间。|
        |**到期付费续用**|选择免费备份服务到期后，是否执行到期付费续用。        -   **否**：免费备份计划到期后自动停止，已备份文件会在到期一周后删除。
        -   **是**：免费备份计划到期后自动转为付费使用，HBR将按照备份文件大小收取备份库存储容量费用。 |

        以上配置会创建一个每天执行一次，备份文件保存一周的备份计划。

    -   配置付费备份计划

        若您希望手动指定备份执行间隔、备份目标文件、备份保留天数等，可以配置付费备份计划。

        1.  在创建备份计划面板，单击**显示高级设置**。
        2.  单击**立即转为付费使用**，然后单击**确定**。
        3.  配置以下参数：

            |参数|说明|
            |--|--|
            |**备份OSS Bucket**|显示当前Bucket名称。|
            |**备份计划名称**|设置备份计划名称，长度不得超过64个字符。可不填，HBR会根据当前时间生成备份计划名称。 |
            |**备份起始时间**|选择备份任务开始执行的时间。|
            |**备份Bucket Prefix**|设置目标Object前缀，备份任务只备份拥有指定前缀的Object。置空时备份整个Bucket。|
            |**备份执行间隔**|选择备份任务的执行频率。时间单位：天、周。|
            |**备份保留策略**|选择备份的保留策略。            -   **指定保留时间**：HBR将按您指定的时间保留备份文件，并在到期后自动删除备份文件。
            -   **永久**：您的备份文件会被永久保存。 |
            |**备份保留时间**|设置备份文件保留的时间。时间单位：天、周、月、年。仅在**备份保留策略**为**指定保留时间**时设置。 |
            |**备份库配置**|设置备份文件存放的备份库。            -   **创建新备份库**：若您在HBR中没有备份库，或您希望将当前备份任务生成的备份文件存放在新的备份库时，您可以创建一个新的备份库。
            -   **选择已有备份库**：若您在HBR中已有备份库，且您希望将当前备份任务生成的备份文件存储在指定备份库中，您可以选择已有备份库。 |

6.  单击**确定**。


## 方式二：创建Bucket时配置定时备份

1.  登录[OSS管理控制台](https://oss.console.aliyun.com/)。

2.  在左侧导航栏，单击**Bucket列表**，之后单击**创建Bucket**。

3.  在创建Bucket面板填写各项参数。

    其中，选择**定时备份**为**开通**。其他参数说明，请参见[创建存储空间](/cn.zh-CN/控制台用户指南/存储空间管理/创建存储空间.md)。

4.  单击**确定**。

    Bucket创建成功后，会自动创建一个每天备份一次、备份文件保存一周的备份计划。此备份计划可免费试用2个月，您可以选择**文件管理** \> **定时备份**，查看或修改已创建的计划。


## 更多参考

您可以通过创建恢复任务将备份文件恢复到OSS中。操作步骤，请参见[创建恢复任务](/cn.zh-CN/OSS备份教程/OSS备份.md)。

