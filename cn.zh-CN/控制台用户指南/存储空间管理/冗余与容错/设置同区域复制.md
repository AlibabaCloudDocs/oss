# 设置同区域复制

同区域复制（Same-Region Replication）是指将源存储空间（Bucket）中的文件（Object）的创建、更新和删除等操作自动、异步地复制到相同地域下的目标Bucket。

使用同区域复制时需注意以下事项：

-   费用说明
    -   进行同区域复制时，OSS会根据复制文件产生的流量收取同区域复制流量费用。计费方式，请参见[流量费用](/cn.zh-CN/计量计费/计量项和计费项/流量费用.md)。
    -   每同步1个Object，OSS会计算请求次数并收取请求费用。计费方式，请参见[请求费用](/cn.zh-CN/计量计费/计量项和计费项/请求费用.md)。
-   使用限制
    -   源Bucket中的数据可以同步到多个目标Bucket。单个Bucket关联的复制规则数量不能超过100条。这些规则中，该Bucket既可以作为源Bucket，也可以作为目标Bucket。如果您的业务场景涉及更大数量的复制规则，请联系[技术支持](https://selfservice.console.aliyun.com/ticket/createIndex)。
    -   源Bucket和目标Bucket必须同时处于非版本化或启用版本控制状态，且处于同步状态下的两个Bucket不允许改变其版本控制状态。

关于同区域复制的更多信息，请参见[同区域复制介绍](/cn.zh-CN/开发指南/数据安全/数据容灾/同区域复制介绍.md)。

## 开启同区域复制

1.  登录[OSS管理控制台](https://oss.console.aliyun.com/)。

2.  在左侧导航栏，单击**Bucket列表**，然后单击目标Bucket。

3.  在左侧导航栏，选择**冗余与容错** \> **同区域复制**。

4.  在**同区域复制**区域，单击**设置**。

5.  单击**同区域复制**。

6.  在**同区域复制**面板，按如下说明配置各项参数。

    |参数|说明|
    |--|--|
    |**源Bucket地域**|您当前Bucket所在地域。|
    |**源Bucket**|您当前Bucket名称。|
    |**目标Bucket**|选择将源Bucket数据同步到相同地域下哪个目标Bucket。|
    |**数据同步对象**|选择需要同步的源数据。     -   **全部文件进行同步**：将该Bucket内所有的Object同步到目标存储空间。
    -   **指定文件名前缀进行同步**：将该Bucket内指定前缀的Object同步到目标Bucket。最多可以添加10个前缀。 |
    |**Object标签**|同步拥有指定标签的Object到目标Bucket。设置方法为选中**设置规则**后添加标签（键-值对），最多可添加10个标签。要设置该参数，必须满足以下条件：

    -   已设置Object标签。具体操作，请参见[设置对象标签](/cn.zh-CN/控制台用户指南/文件管理/设置对象标签.md)。
    -   源Bucket和目标Bucket均已开启版本控制。
    -   数据同步策略为**增/改 同步**。 |
    |**数据同步策略**|选择数据同步的方式。     -   **增/改 同步**：仅将该Bucket内Object新增和更新操作同步到目标Bucket。
    -   **增/删/改 同步**：将该Bucket内Object的新增、更新、删除操作同步到目标Bucket。 |
    |**同步历史数据**|选择是否同步复制规则生效前源Bucket中已有的历史数据。    -   **同步**：将历史数据同步至目标Bucket。

**说明：** 同步历史数据时，从源Bucket复制的Object可能会覆盖目标Bucket中同名的Object。为避免这部分文件丢失，建议您对源Bucket和目标Bucket开启版本控制。

    -   **不同步**：仅同步复制规则生效后上传或更新的Object。 |
    |**KMS加密目标对象**|在源Object或者目标Bucket使用了KMS托管密钥加密方式（即SSE-KMS，指定CMK ID）的情况下，要将Object复制到目标Bucket，则必须选中**KMS加密目标对象**，并配置以下参数：    -   **使用的KMS密钥**：为目标Object指定加密的KMS密钥。

您需要提前在KMS平台创建一个与目标Bucket相同地域的KMS密钥。具体操作，请参见[管理密钥]()。

    -   **授权角色**：授权一个RAM角色对目标Object执行KMS加密操作。
        -   **新建角色**：新建RAM角色对目标Object执行KMS加密，角色名称格式为`kms-replication-源Bucket名称-目标Bucket名称`。
        -   **AliyunOSSRole**：使用AliyunOSSRole角色对目标Object执行KMS加密。若您之前未创建AliyunOSSRole角色，当您选择此项时，OSS将自动创建AliyunOSSRole角色。
**说明：** 您可以通过[HeadObject](/cn.zh-CN/API 参考/关于Object操作/基础操作/HeadObject.md)和[GetBucketEncryption](/cn.zh-CN/API 参考/关于Bucket的操作/加密（Encryption）/GetBucketEncryption.md)分别查询源Object和目标Bucket的加密状态。 |

7.  单击**确定**。

    -   当同区域复制规则创建完成后，不允许对此规则进行编辑或删除。
    -   同步任务会在同区域复制规则配置完成后即刻启动，您可以在同区域复制页面查看同步进度。
    -   数据复制到目标Bucket需要的时间取决于数据的大小，通常几分钟到几小时不等。

## 停止同区域复制

您可以通过单击**关闭同步**来停止同区域复制。

![sync](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0348867161/p135995.png)

关闭同步后，已复制的数据将被保留在目标Bucket中，源Bucket中的增量数据将不再复制到目标Bucket。

