# 设置跨区域复制

跨区域复制是在不同OSS地域之间自动、异步（近实时）复制文件（Object），将源存储空间（Bucket）中Object的改动（新建、覆盖、删除等操作）同步到目标Bucket中。

跨区域复制功能能够很好的提供Bucket跨区域容灾或满足用户数据复制的需求。目标Bucket中的Object是源Bucket中Object的精确副本，它们具有相同的Object名、元数据以及内容，例如创建时间、拥有者、用户定义的元数据、Object ACL、Object内容等。

关于跨区域复制功能的更多详情，请参见[跨区域复制介绍](/cn.zh-CN/开发指南/数据安全/数据容灾/跨区域复制介绍.md)。

## 开启跨区域复制

开启跨区域复制的详细操作步骤如下：

1.  登录[OSS管理控制台](https://oss.console.aliyun.com/)。

2.  单击**Bucket列表**，之后单击目标Bucket名称。

3.  单击**冗余与容错** \> **跨区域复制**。

4.  单击**开启同步**，在弹出的跨区域复制面板配置跨区域复制规则。

    |参数|说明|
    |--|--|
    |**源Bucket地域**|显示您当前Bucket所在地域。|
    |**源Bucket**|显示您当前Bucket名称。|
    |**目标地域**|选择目标Bucket所在地域。数据同步的两个存储空间必须分属两个地域，同地域的存储空间之间不能进行数据同步。 |
    |**目标Bucket**|选择开启数据同步的目标Bucket。跨区域复制的两个Bucket都不能同时与其他任何Bucket存在互相同步的关系。例如已设置Bucket A的数据同步至Bucket B，则Bucket A和Bucket B都不能和其他任何Bucket再建立数据同步关系。 |
    |**加速类型**|中国内地各地域与非中国内地各地域进行跨区域复制时，必须开启传输加速功能。传输加速功能介绍，请参见[传输加速](/cn.zh-CN/开发指南/存储空间（Bucket）/传输加速.md)。|
    |**数据同步对象**|选择需要同步的源数据。     -   **全部文件进行同步**：将该Bucket内所有的Object同步到目标存储空间。
    -   **指定文件名前缀进行同步**：将该Bucket内指定前缀的Object同步到目标Bucket。最多可以添加10个前缀。

例如，您的源Bucket下有一个根目录为management/，management/下有个文件目录abc/，您需要同步abc/文件目录下的所有数据，则填写management/abc/。 |
    |**Object标签**|同步拥有指定标签的Object到目标Bucket。设置方法为选中**设置规则**后添加标签（键-值对），最多可添加10个标签。要设置该参数，必须满足以下条件：

    -   已设置Object标签。具体操作，请参见[设置对象标签](/cn.zh-CN/控制台用户指南/文件管理/设置对象标签.md)。
    -   源和目标Bucket均开启版本控制功能。
    -   数据同步策略为**增/改 同步**。
    -   源地域为华东1（杭州），目标地域为除了华东1（杭州）以外的任何一个地域；或者源地域为澳大利亚（悉尼），目标地域为除了华东1（杭州）以外的任何一个地域。 |
    |**数据同步策略**|选择数据同步的方式。     -   **增/改 同步**：仅将该Bucket内新增和更新的数据同步到目标Bucket。
    -   **增/删/改 同步**：将该Bucket的所有数据，包括新增、更新、删除操作同步到目标Bucket。
有关跨区域复制结合版本控制的行为说明，请参见[跨区域复制结合版本控制](/cn.zh-CN/开发指南/数据安全/数据容灾/特殊场景下的复制行为.md)。 |
    |**同步历史数据**|选择是否同步跨区域复制规则生效前源Bucket中已有的历史数据。    -   **同步**：将历史数据同步至目标Bucket。

**说明：** 历史数据同步时，从源Bucket复制的Object可能会覆盖目标Bucket中同名的Object。为避免覆盖同名Object，建议您对源Bucket和目标Bucket开启版本控制。

    -   **不同步**：仅同步跨区域复制规则生效后上传或更新的Object。 |
    |**KMS加密目标对象**|选中**KMS加密目标对象**后可将源Bucket中使用KMS托管密钥加密（SSE-KMS，指定CMK ID）的Object复制到目标Bucket。    -   **使用的KMS密钥**：用于加密目标Object的KMS密钥，即为目标Object重新指定CMK ID。

您需要提前在KMS平台创建一个与目标Bucket相同地域的KMS密钥。配置步骤，请参见[管理密钥](/cn.zh-CN/用户指南/管理密钥.md)。

使用KMS密钥功能时会产生少量的KMS密钥API调用费用。费用详情，请参考[KMS计费标准](/cn.zh-CN/产品定价/计费说明.md)。

有关跨区域复制结合服务器端加密详情，请参见[跨区域复制结合服务器端加密](/cn.zh-CN/开发指南/数据安全/数据容灾/特殊场景下的复制行为.md)。

    -   **授权角色**：授权新建角色或AliyunOSSRole角色对目标Object执行KMS加密。
        -   **新建角色**：当您选择新建角色用于对目标Object执行KMS加密时，OSS将自动创建角色，角色名称格式为kms-replication-源Bucket名称-目标Bucket名称。
        -   **AliyunOSSRole**：若您之前未创建AliyunOSSRole角色，当您选择此项时，OSS将自动创建AliyunOSSRole角色，用于对目标Object执行KMS加密。 |

5.  单击**确定**。

    -   当跨区域复制规则创建完成后，不允许对此规则进行编辑或删除。
    -   配置跨区域复制规则后，增量数据将会在开启同步功能的3~5分钟之后启动同步任务。如果选择同步历史数据，历史数据将会在开启同步功能的90分钟之后启动同步任务。同步任务启动后会显示同步进度的相关信息。
    -   由于Bucket间的跨区域复制采用异步（近实时）复制，数据复制到目标Bucket需要的时间取决于数据的大小，通常几分钟到几小时不等。

## 停止跨区域复制

您可以通过单击**关闭同步**来停止跨区域复制。

![sync](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/3594459951/p135995.png)

关闭同步后，已复制的数据将被保留在目标Bucket中，源Bucket中的增量数据将不再复制到目标Bucket。

